---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
"""re attempting horn combination work"""
```

```{python}
import glob
# import re
# import os
import numpy as np
import matplotlib.pyplot as plt
import qubic
from CSFPA_dataIO import calculate_intensity_4_baseline
```

```{python}
qbrep = '/media/james/DATA/GRASPdata/DavesTabSourceFIModel/MODALfiles/'
files = sorted(glob.glob(qbrep+'*.qb'))
print('read', len(files), 'files')
```

```{python}
FIhorns = np.linspace(1,400,400, dtype=int)

tdrow1 = np.linspace(120, 127, 8, dtype=int)
tdrow2 = np.linspace(142, 149, 8, dtype=int)
tdrow3 = np.linspace(164, 171, 8, dtype=int)
tdrow4 = np.linspace(186, 193, 8, dtype=int)
tdrow5 = np.linspace(208, 215, 8, dtype=int)
tdrow6 = np.linspace(230, 237, 8, dtype=int)
tdrow7 = np.linspace(252, 259, 8, dtype=int)
tdrow8 = np.linspace(274, 281, 8, dtype=int)
TDhorns = np.concatenate((tdrow1, tdrow2, tdrow3, tdrow4, tdrow5, tdrow6, tdrow7, tdrow8))
#TDhorns.extend(tdrow1, tdrow2)
print(TDhorns.shape, FIhorns.shape)

#example baseline
baseline = [120, 127]
print(baseline)
```

```{python}
d = qubic.qubicdict.qubicDict()
d.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
d['config'] = 'FI'
q = qubic.QubicInstrument(d)

centers = q.horn.center[:, 0:2]
col = q.horn.column
row = q.horn.row

instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open

hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()
for i in range(len(centers)):
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
    
instTD.horn.plot()
plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
tdpair1 = [41,59]
tdpair2 = [34,52]
tdpair1 = [2,6]
tdpair2 = [10,14]
print(FIhorns[np.where(TDhornsFIconf == tdpair1[0])], type(tdpair1))
print(TDhornsFIconf)

testhorns = np.append(tdpair1, tdpair2)
testhornsFI = np.zeros(4)
print(testhorns.shape, type(testhorns), testhorns[0:2], testhorns[0:2])

kk=0
for i, j in enumerate(FIhorns):
    
    if TDhornsFIconf[i] in testhorns:
        print(j, TDhornsFIconf[i])
        testhornsFI[kk] = j
        kk+=1
        
print(testhornsFI)
```

```{python}
"""here is a plotter to show the TD baseline horns, pair 1 green"""
plt.figure(figsize=(10,10))
#q.horn.plot()
cnt = 1
for i in range(len(centers)):
    if hornsTD[i] == True:
        plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
        cnt+=1
    
    #print(FIhorns[i], FIhorns[np.where(TDhornsFIconf == tdpair1[0])])
    #if FIhorns[i] == FIhorns[np.where(TDhornsFIconf == tdpair1[0])]:
    if TDhornsFIconf[i] in tdpair1:
        plt.plot(centers[i,0]-0.0005, centers[i,1]+0.0005, 'D', color='xkcd:burnt orange',  
                 markersize=29, alpha=0.4, mfc = None)
        
    if TDhornsFIconf[i] in tdpair2:
        plt.plot(centers[i,0]-0.0005, centers[i,1]+0.0005, 'D', color='xkcd:sea green',  
                 markersize=29, alpha=0.4, mfc = None)
        
instTD.horn.plot()
plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
#calculate_intensity_4_baseline
my150dat = '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/'

# tdpair1 = [41,59]
# tdpair2 = [34,52]
# tdpair1 = [2,6]
# tdpair2 = [10,14]
tdpair1 = [49,53]
tdpair2 = [17,21]

print(FIhorns[np.where(TDhornsFIconf == tdpair1[0])])
fipair1 = [int(FIhorns[np.where(TDhornsFIconf == tdpair1[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair1[1])])]
fipair2 = [int(FIhorns[np.where(TDhornsFIconf == tdpair2[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair2[1])])]

print(fipair1)

x, y, p1i = calculate_intensity_4_baseline(fipair1, qbrep)
x, y, p2i = calculate_intensity_4_baseline(fipair2, qbrep)
print(p1i.shape, p2i.shape)
diff = p1i-p2i
```

```{python}
plt.figure(figsize=(10,2))

plt.subplot(1,3,1)
plt.scatter(x, y, c=p1i/max(p1i))
plt.colorbar()
plt.subplot(1,3,2)
plt.scatter(x, y, c=p2i/max(p2i))
plt.colorbar()
plt.subplot(1,3,3)
plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-1, vmax=1,) #vmin=0, vmax=1,
plt.colorbar()
```

```{python}

```
