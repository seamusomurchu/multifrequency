---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
import numpy as np
import glob
import matplotlib.pyplot as plt
from qbdataio import MultiHornMain
```

```{python}
#oldtabfield = np.loadtxt('/home/james/graspfiles/tabsourcefiles/Horn_Clover12b_150GHzSM_Coherent_NF__with_ORTH_grdfileXPOLONLY.grd', skiprows=8).T
oldtabfield = np.loadtxt('/media/james/DATA/LaptopFiles/graspfiles/tabsourcefiles/Horn_Clover12b_150GHzSM_Coherent_NF__with_ORTH_grdfileXPOLONLY.grd', skiprows=7).T
print(oldtabfield.shape)
#davetabfield = np.loadtxt('/home/james/graspfiles/tabsourcefiles/150tabsourcedave.grd', skiprows=8).T
davetabfield = np.loadtxt('/media/james/DATA/MODALhorn/DavesVersion/150hornoutput.dat', skiprows=1).T
print(davetabfield.shape)
#mysource = np.loadtxt('/media/james/DATA/MODALhorn/150 horn output.dat', skiprows=1).T
mysource = np.loadtxt('/media/james/DATA/MODALhorn2/150hornoutput1123.dat', skiprows=1).T
print(mysource.shape)
```

```{python}
#convert donnys ap field to .dat
#do calculations for amp and phase

ampXvar = np.sqrt(oldtabfield[0,:]**2 + oldtabfield[1,:]**2) 

phaXvar = np.arctan2(oldtabfield[1,:],oldtabfield[0,:])

ampYvar = np.sqrt(oldtabfield[2,:]**2 + oldtabfield[3,:]**2) 

phaYvar = np.arctan2(oldtabfield[3,:],oldtabfield[2,:])

ampZvar = np.sqrt(oldtabfield[4,:]**2 + oldtabfield[5,:]**2) 

phaZvar = np.arctan2(oldtabfield[5,:],oldtabfield[4,:])

print(ampXvar.shape)

xvals = np.linspace(-6.167E-00, 6.167E-00, 101)
yvals = np.linspace(-6.167E-00, 6.167E-00, 101)
X,Y = np.meshgrid(xvals, yvals)
pts = np.c_[Y.ravel(), X.ravel()]


print(ampXvar.shape, X.shape, pts.shape)
#print(pts[:,0].shape, min(abs(pts[:,0])))

plt.plot(pts[:,1][np.where(pts[:,0] == 0)], ampXvar[np.where(pts[:,0] == 0)], '.')
plt.plot(pts[:,0][np.where(pts[:,1] == 0)], ampXvar[np.where(pts[:,1] == 0)], '.')
plt.plot(pts[:,1][np.where(pts[:,0] == pts[:,1])], ampXvar[np.where(pts[:,0] == pts[:,1])], '.')
```

```{python}
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 22}

plt.rc('font', **font)
plt.figure(figsize=(12,10))

plt.subplot(2,2,1)
plt.scatter(davetabfield[2,:], davetabfield[3,:], c=davetabfield[4,:])
plt.title('Daves File col4')
plt.colorbar()
plt.subplot(2,2,2)
plt.scatter(davetabfield[2,:], davetabfield[3,:], c=davetabfield[5,:])
plt.title('Daves File col5')
plt.colorbar()
plt.subplot(2,2,3)
plt.scatter(davetabfield[2,:], davetabfield[3,:], c=davetabfield[6,:])
plt.title('Daves File col6')
plt.colorbar()
plt.subplot(2,2,4)
plt.scatter(davetabfield[2,:], davetabfield[3,:], c=davetabfield[7,:])
plt.title('Daves File col7')
plt.colorbar()


plt.figure(figsize=(12,10))

plt.subplot(2,2,1)
plt.scatter(mysource[2,:], mysource[3,:], c=mysource[4,:])
plt.title('My Source')
plt.colorbar()
plt.subplot(2,2,2)
plt.scatter(mysource[2,:], mysource[3,:], c=mysource[5,:])
plt.title('My Source')
plt.colorbar()
plt.subplot(2,2,3)
plt.scatter(mysource[2,:], mysource[3,:], c=mysource[6,:])
plt.title('My Source')
plt.colorbar()
plt.subplot(2,2,4)
plt.scatter(mysource[2,:], mysource[3,:], c=mysource[7,:])
plt.title('My Source')
plt.colorbar()

#now normalise and do difference
mys = mysource[4,:]/max(mysource[4,:])
ds = davetabfield[4,:]/max(davetabfield[4,:])
print(mys.shape, ds.shape)

plt.figure(figsize=(12,10))

plt.scatter(mysource[2,:], mysource[3,:], c=mys-ds)
plt.title('Difference')
plt.colorbar()

```

```{python}
colors = plt.rcParams["axes.prop_cycle"].by_key()["color"]
print(colors)
r = np.sqrt(pts[:,0][np.where(pts[:,1] == pts[:,0])]**2 + pts[:,1][np.where(pts[:,1] == pts[:,0])]**2)
print(r.shape, (mysource[4,:][np.where(mysource[3,:] == mysource[2,:])]/max(mysource[4,:])).shape)
```

```{python}
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 22}

plt.rc('font', **font)
plt.figure(figsize=(16,8))
#x cuts
plt.plot(pts[:,0][np.where(pts[:,1] == 0)], ampXvar[np.where(pts[:,1] == 0)]/max(ampXvar), color='#ff7f0e', 
         linewidth=3, label=r'Scatter 0$\degree$ cut')
plt.plot(davetabfield[2,:][np.where(davetabfield[3,:]==0)], 
         davetabfield[4,:][np.where(davetabfield[3,:]==0)]/max(davetabfield[4,:]), '--', color='#2ca02c',
         linewidth=3, label='MODAL 0$\degree$ cut')
plt.plot(mysource[2,:][np.where(mysource[3,:]==0)], 
         mysource[4,:][np.where(mysource[3,:]==0)]/max(mysource[4,:]), ':', color='#d62728', 
         linewidth=3, label='MODAL v2 0$\degree$ cut')

#45 deg cuts
# plt.plot(pts[:,0][np.where(pts[:,1] == pts[:,0])], ampXvar[np.where(pts[:,1] == pts[:,0])]/max(ampXvar), 
#          color='#7f7f7f', linewidth=3, label='Donnys Scatter 45 cut')
plt.plot(r, ampXvar[np.where(pts[:,1] == pts[:,0])]/max(ampXvar), 
         color='#9467bd', linewidth=3, label='Scatter 45$\degree$ cut')

plt.plot(r, 
         davetabfield[4,:][np.where(davetabfield[3,:] == davetabfield[2,:])]/max(davetabfield[4,:]), 
         '--', color='#8c564b', linewidth=3, label='MODAL 45$\degree$ cut')
plt.plot(r, 
         mysource[4,:][np.where(mysource[3,:] == mysource[2,:])]/max(mysource[4,:]), ':', color='#e377c2', 
         linewidth=3, label='MODAL v2 45$\degree$ cut')

#ycuts
plt.plot(pts[:,1][np.where(pts[:,0] == 0)], ampXvar[np.where(pts[:,0] == 0)]/max(ampXvar), color='#7f7f7f', 
         linewidth=3, label='Scatter 90$\degree$ cut')
plt.plot(davetabfield[3,:][np.where(davetabfield[2,:]==0)], 
         davetabfield[4,:][np.where(davetabfield[2,:]==0)]/max(davetabfield[4,:]), '--', color='#bcbd22',
         linewidth=3, label='MODAL 90$\degree$ cut')
plt.plot(mysource[3,:][np.where(mysource[2,:]==0)], 
         mysource[4,:][np.where(mysource[2,:]==0)]/max(mysource[4,:]), ':', color='#17becf', 
         linewidth=3, label='MODAL v2 90$\degree$ cut')

plt.grid(True)
plt.ylabel("Normalised Intenisty (dB)")
plt.xlabel('Aperture Field (mm)')
plt.title('Corrugated Horn Aperture Field')
plt.xlim(0,6.5)
plt.legend(loc='lower left')
#plt.savefig("/home/james/OneDrive/ThesisPlots/apfield.png", bbox_inches='tight', facecolor='white')


```

```{python}
"""try this plot in a 3x1 arrangement"""
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16,18))

plt.subplot(3,1,1 )

plt.plot(pts[:,0][np.where(pts[:,1] == 0)], ampXvar[np.where(pts[:,1] == 0)]/max(ampXvar), color='#ff7f0e', 
         linewidth=3, label=r'Scatter 0$\degree$ cut')
plt.plot(davetabfield[2,:][np.where(davetabfield[3,:]==0)], 
         davetabfield[4,:][np.where(davetabfield[3,:]==0)]/max(davetabfield[4,:]), color='#2ca02c',
         linewidth=3, label='MODAL 0$\degree$ cut')
plt.plot(mysource[2,:][np.where(mysource[3,:]==0)], 
         mysource[4,:][np.where(mysource[3,:]==0)]/max(mysource[4,:]), color='#d62728', 
         linewidth=3, label='MODAL 0$\degree$ cut (frequency model)')

plt.grid(True)
plt.ylabel("Normalised Intenisty (dB)")
plt.xlabel('Aperture Field (mm)')
plt.title('Corrugated Horn Aperture Field 0$\degree$ Cut')
plt.xlim(0,6.5)
plt.legend(loc='lower left')

plt.subplot(3,1,2)
plt.plot(r, ampXvar[np.where(pts[:,1] == pts[:,0])]/max(ampXvar), 
         color='#ff7f0e', linewidth=3, label='Scatter 45$\degree$ cut')
plt.plot(r, 
         davetabfield[4,:][np.where(davetabfield[3,:] == davetabfield[2,:])]/max(davetabfield[4,:]), 
         color='#2ca02c', linewidth=3, label='MODAL 45$\degree$ cut')
plt.plot(r, 
         mysource[4,:][np.where(mysource[3,:] == mysource[2,:])]/max(mysource[4,:]), color='#d62728', 
         linewidth=3, label='MODAL 45$\degree$ cut (frequency model)')
plt.grid(True)
plt.ylabel("Normalised Intenisty (dB)")
plt.xlabel('Aperture Field (mm)')
plt.title('Corrugated Horn Aperture Field 45$\degree$ Cut')
plt.xlim(0,6.5)
plt.legend(loc='lower left')

plt.subplot(3,1,3)
#ycuts
plt.plot(pts[:,1][np.where(pts[:,0] == 0)], ampXvar[np.where(pts[:,0] == 0)]/max(ampXvar), color='#ff7f0e', 
         linewidth=3, label='Scatter 90$\degree$ cut')
plt.plot(davetabfield[3,:][np.where(davetabfield[2,:]==0)], 
         davetabfield[4,:][np.where(davetabfield[2,:]==0)]/max(davetabfield[4,:]), color='#2ca02c',
         linewidth=3, label='MODAL 90$\degree$ cut')
plt.plot(mysource[3,:][np.where(mysource[2,:]==0)], 
         mysource[4,:][np.where(mysource[2,:]==0)]/max(mysource[4,:]), color='#d62728', 
         linewidth=3, label='MODAL 90$\degree$ cut (frequency model)')
plt.grid(True)
plt.ylabel("Normalised Intenisty (dB)")
plt.xlabel('Aperture Field (mm)')
plt.title('Corrugated Horn Aperture Field 90$\degree$ Cut')
plt.xlim(0,6.5)
plt.legend(loc='lower left')

plt.tight_layout()
#plt.savefig("/home/james/OneDrive/ThesisPlots/apfield3x1.png", bbox_inches='tight', facecolor='white')
```

```{python}
"""now load data for spherical far field cut"""
#donnys scatter model
scat0deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/scatter_spherical_0deg.cut', 
                      skiprows=6, delimiter=',').T
scat45deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/scatter_spherical_45deg.cut', 
                      skiprows=6, delimiter=',').T
scat90deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/scatter_spherical_90deg.cut', 
                      skiprows=6, delimiter=',').T
#daves modal
modal0deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/MODAL_spherical_0deg.cut', 
                      skiprows=6, delimiter=',').T
modal45deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/MODAL_spherical_45deg.cut', 
                      skiprows=6, delimiter=',').T
modal90deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/MODAL_spherical_90deg.cut', 
                      skiprows=6, delimiter=',').T
#myversion of daves
mymodal0deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/myMODALv2_spherical_0deg.cut', 
                      skiprows=6, delimiter=',').T
mymodal45deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/myMODALv2_spherical_45deg.cut', 
                      skiprows=6, delimiter=',').T
mymodal90deg = np.loadtxt('/home/james/OneDrive/SharedFolderUbuntu/myMODALv2_spherical_90deg.cut', 
                      skiprows=6, delimiter=',').T

#gaussian
gauscut = np.loadtxt('/media/james/DATA/LaptopFiles/graspfiles/newsourcetesting/gausscut.cut', skiprows=3, delimiter=',').T

print(scat0deg.shape)
```

```{python}
#plot the spherical far field
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 22}

plt.rc('font', **font)
plt.figure(figsize=(16,8))
#gaussian
plt.plot(gauscut[0,:], gauscut[1,:], label='Gaussian Model', linewidth=3)
#donnys scat
plt.plot(scat0deg[0,:], scat0deg[1,:], label=r'Scatter 0$\degree$ cut', linewidth=3)
plt.plot(scat45deg[0,:], scat45deg[1,:], '--', label=r'Scatter 45$\degree$ cut', linewidth=3)
plt.plot(scat90deg[0,:], scat90deg[1,:], ':', label=r'Scatter 90$\degree$ cut', linewidth=3)
#daves modal
plt.plot(modal0deg[0,:], modal0deg[1,:], label=r'Scatter 0$\degree$ cut', linewidth=3)
plt.plot(modal45deg[0,:], modal45deg[1,:], '--', label=r'Scatter 45$\degree$ cut', linewidth=3)
plt.plot(modal45deg[0,:], modal45deg[1,:], ':',label=r'Scatter 90$\degree$ cut', linewidth=3)
#my modal
plt.plot(mymodal0deg[0,:], mymodal0deg[1,:], label=r'Scatter 0$\degree$ cut', linewidth=3)
plt.plot(mymodal45deg[0,:], mymodal45deg[1,:], '--', label=r'Scatter 45$\degree$ cut', linewidth=3)
plt.plot(mymodal90deg[0,:], mymodal90deg[1,:], ':', label=r'Scatter 90$\degree$ cut', linewidth=3)

plt.legend(loc='upper right')
plt.grid(True)
plt.ylabel("Intenisty (dB)")
plt.xlabel(r'Angle $\theta$ ($^\circ$)')
plt.title('Source Comparison 200 mm Spherical Cut')
plt.xlim(0,90)
plt.ylim(-85, -31)
```

```{python}
"""try this plot in a 3x1 arrangement"""
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16,18))

plt.subplot(3,1,1 )

#gaussian
plt.plot(gauscut[0,:], gauscut[1,:], label='Gaussian model', linewidth=3)
#0deg
plt.plot(scat0deg[0,:], scat0deg[1,:], label=r'Scatter 0$\degree$ cut', linewidth=3)
plt.plot(modal0deg[0,:], modal0deg[1,:], label=r'MODAL 0$\degree$ cut', linewidth=3)
plt.plot(mymodal0deg[0,:], mymodal0deg[1,:], label=r'MODAL 0$\degree$ cut (frequency model)', linewidth=3)

plt.legend(loc='upper right')
plt.grid(True)
plt.ylabel("Intenisty (dB)")
plt.xlabel(r'Angle $\theta$ ($^\circ$)')
plt.title('Source Comparison 200 mm Spherical 0$\degree$ Cut')
plt.xlim(0,90)
plt.ylim(-85, -31)

plt.subplot(3,1,2)
#gaussian
plt.plot(gauscut[0,:], gauscut[1,:], label='Gaussian model', linewidth=3)
#45deg
plt.plot(scat45deg[0,:], scat45deg[1,:], label=r'Scatter 45$\degree$ cut', linewidth=3)
plt.plot(modal45deg[0,:], modal45deg[1,:], label=r'MODAL 45$\degree$ cut', linewidth=3)
plt.plot(mymodal45deg[0,:], mymodal45deg[1,:], label=r'MODAL 45$\degree$ cut (frequency model)', linewidth=3)
plt.legend(loc='upper right')
plt.grid(True)
plt.ylabel("Intenisty (dB)")
plt.xlabel(r'Angle $\theta$ ($^\circ$)')
plt.title('Source Comparison 200 mm Spherical 45$\degree$ Cut')
plt.xlim(0,90)
plt.ylim(-85, -31)

plt.subplot(3,1,3)
#gaussian
plt.plot(gauscut[0,:], gauscut[1,:], label='Gaussian model', linewidth=3)
#ycuts
#90deg
plt.plot(scat90deg[0,:], scat90deg[1,:], label=r'Scatter 90$\degree$ cut', linewidth=3)
plt.plot(modal45deg[0,:], modal45deg[1,:],label=r'MODAL 90$\degree$ cut', linewidth=3)
plt.plot(mymodal90deg[0,:], mymodal90deg[1,:], label=r'MODAL 90$\degree$ cut (frequency model)', linewidth=3)
plt.legend(loc='upper right')
plt.grid(True)
plt.ylabel("Intenisty (dB)")
plt.xlabel(r'Angle $\theta$ ($^\circ$)')
plt.title('Source Comparison 200 mm Spherical 90$\degree$ Cut')
plt.xlim(0,90)
plt.ylim(-85, -31)

plt.tight_layout()
#plt.savefig("/home/james/OneDrive/ThesisPlots/spherical3x1.png", bbox_inches='tight', facecolor='white')
```

```{python}

```
