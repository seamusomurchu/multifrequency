---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
"""this file will take the grasp/modal files and generate intensity data for the detectors"""
```

```{python}
from CSFPA_main import MainProg
from CSFPA_dataIO import IntensityCalcRAW, getXYcoords, dataIO, RetrieveVars
from CSFPA_plots import MultiFIntensityTESPlot
import glob
import re
import os
import numpy as np
import matplotlib.pyplot as plt
```

```{python}
tesdatrep = '/home/james/GRASPdata/DavesTabSourceFIModel/TESdat/'
pklrep = '/home/james/GRASPdata/DavesTabSourceFIModel/PKLfiles/'
qbrep = '/home/james/GRASPdata/DavesTabSourceFIModel/MODALfiles/'
files = sorted(glob.glob(qbrep+'*.qb'))
print('read', len(files), 'files')
```

```{python}
print(files[0])
fpath = os.path.basename(files[0])
#print(fname)
fname = os.path.splitext(fpath)[0]
#print(fname)
hnum = re.search(r'\d+', fname).group(0)
print("horn number and file name: ",hnum, fname)
Ix, Iy, IT = IntensityCalcRAW(files[0])
#sum the intensity and compare the 4pi, the total power of a horn
print(sum(IT), IT.shape)
print(4*np.pi, sum(IT)/(4*np.pi))
```

```{python}

```

```{python}

#i think this saves both TES and pkl files 

"""get the intensity integrated over the bolometers"""
#also initialise folrder for tes data
tesdat150 = '/home/james/GRASPdata/DavesTabSourceFIModel/TESdat/'

MainProg(files[0], pklrep, tesdat150)
```

```{python}
pklfiles = sorted(glob.glob(pklrep+'*.pkl'))
print(len(pklfiles))
MagXarr, PhaXarr, ReXarr, ImXarr, MagYarr, PhaYarr, ReYarr, ImYarr, vtxcntarr, PixCenX, PixCenY, IntX, IntY, IntT, Ix, Iy, IT, xycoords, filename, freq = RetrieveVars(pklfiles[0])


#MultiFIntensityTESPlot(IT,PixCenX, PixCenY, "singlepkl")
```

```{python}
plt.figure(figsize=(16,16))

plt.scatter(PixCenX*1000,PixCenY*1000, c=IntT, cmap='jet',marker='s', s=200)
plt.axis([-60, 60, -60, 60])
plt.axis('equal')
plt.title("sample", fontsize=10)
plt.subplots_adjust(bottom=0.1, right=0.8, top=0.9)
cax = plt.axes([0.825, 0.1, 0.04, 0.8])
plt.colorbar(cax=cax,label="Intensity (W)", shrink=0.9)
plt.show()
```

```{python}
"""okay this works now run for all TES. Creat TES and PKLs for all grasp/modal data"""

for file in files:
    print(file)
    MainProg(file, pklrep, tesdat150)
```

```{python}

```
