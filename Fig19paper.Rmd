---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from CSFPA_dataIO import *
from CSFPA_plots import baseline_plotter
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import glob
import qubic
```

```{python}
"""i beleive this link has the optical data... -> https://maynoothuniversity-my.sharepoint.com/:u:/g/personal/james_murphy_2018_mumail_ie/EWFWx6YTco5ChvdzA1-MWesBTpRqsv30ttpKVwOlI8Ue1w?e=ICYVum"""
```

```{python}
def baseline_plotter(x, y, p1i, p2i, diff, TDhornsFIconf, instTD, tdpair1, tdpair2, centers, virtual_diff=False):
    """elaborate baseline comparison plot
    use show_baseline_types script to use this function"""
    
    plt.figure(figsize=(10,8))
    plt.subplot(2,2,1)
    plt.scatter(x, y, c=p1i/max(p1i))
    plt.title('Horns: {} & {}'.format(int(tdpair1[0]), int(tdpair1[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,2)
    plt.scatter(x, y, c=p2i/max(p2i))
    plt.title('Horns: {} & {}'.format(int(tdpair2[0]), int(tdpair2[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,4)
    
    if virtual_diff is True:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
    if virtual_diff is False:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
    plt.title('Residual Difference')
    plt.colorbar(label='Normalised Intensity Difference (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,3)
    instTD.plot()
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[0]), 0], centers[np.where(TDhornsFIconf == tdpair1[0]), 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[1]), 0], centers[np.where(TDhornsFIconf == tdpair1[1]), 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[0]), 0], centers[np.where(TDhornsFIconf == tdpair2[0]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[1]), 0], centers[np.where(TDhornsFIconf == tdpair2[1]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def baseline_plotter_FI(x, y, p1i, p2i, diff, instFI, fipair1, fipair2, centers, virtual_diff=False):
    """elaborate baseline comparison plot
    use show_baseline_types script to use this function"""
    
    plt.figure(figsize=(10,8))
    plt.subplot(2,2,1)
    plt.scatter(x, y, c=p1i/max(p1i))
    plt.title('Horns: {} & {}'.format(int(fipair1[0]), int(fipair1[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,2)
    plt.scatter(x, y, c=p2i/max(p2i))
    plt.title('Horns: {} & {}'.format(int(fipair2[0]), int(fipair2[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,4)
    
    if virtual_diff is True:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
    if virtual_diff is False:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
    plt.title('Residual Difference')
    plt.colorbar(label='Normalised Intensity Difference (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,3)
    instFI.plot()
    plt.plot(centers[fipair1[0]-1, 0], centers[fipair1[0]-1, 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[fipair1[1]-1, 0], centers[fipair1[1]-1, 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[fipair2[0]-1, 0], centers[fipair2[0]-1, 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[fipair2[1]-1, 0], centers[fipair2[1]-1, 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def simple_baseline_plotter(TDhornsFIconf, tdpair1, tdpair2, centers):
    """elaborate baseline comparison plot
    requires you have qubic inst loaded e.g.
    instFI = qubic.QubicInstrument(d)
    hornsFI = instFI.horn.open
    hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
    ### Now create First Instrument and TD monochromatic
    instTD = qubic.QubicInstrument(d)
    instTD.horn.open[~hornsTD] = False"""
    import qubic
    d = qubic.qubicdict.qubicDict()
    d.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
    d['config'] = 'FI'
    q = qubic.QubicInstrument(d)
    centers = q.horn.center[:, 0:2]
    col = q.horn.column
    row = q.horn.row
    instFI = qubic.QubicInstrument(d)
    hornsFI = instFI.horn.open
    hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
    instTD = qubic.QubicInstrument(d)
    instTD.horn.open[~hornsTD] = False
    
    plt.figure(figsize=(14,14))

    instTD.horn.plot()
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[0]), 0], centers[np.where(TDhornsFIconf == tdpair1[0]), 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[1]), 0], centers[np.where(TDhornsFIconf == tdpair1[1]), 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[0]), 0], centers[np.where(TDhornsFIconf == tdpair2[0]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[1]), 0], centers[np.where(TDhornsFIconf == tdpair2[1]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def calculate_intensity_4_baseline(baseline, datadir):
    
    #initial load to setup arrays, could be improved!
    data = pd.read_csv(datadir+'FP_planar_grid_horn'+str(100)+'_150_GHz_Mstyle.qb', sep='\t')
    addimx = np.zeros(len(data['Rex']))
    addrex = np.zeros(len(data['Rex']))
    addrey = np.zeros(len(data['Rex']))
    addimy = np.zeros(len(data['Rex']))

    #here we loop through the chosen config, baseline, load the 'qb' files
    #and add the instensities

    #baseline, TDhorns, FIhorns all interchangeable here
    cnt = 0
    for horn in baseline:

        #print(datadir+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb')
        file = datadir+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
        data = pd.read_csv(file, sep='\t')
        #print(data.shape)

        #add the relevant compnents to an array
        addrex = np.vstack((addrex, data['Rex']))
        addimx = np.vstack((addimx, data['Imx']))
        addrey = np.vstack((addrey, data['Rey']))
        addimy = np.vstack((addimy, data['Imy']))

        cnt+=1

    #add / flatten the array
    addrex = np.sum(addrex.T, axis=1, dtype=float)
    addimx = np.sum(addimx.T, axis=1, dtype=float)
    addrey = np.sum(addrey.T, axis=1, dtype=float)
    addimy = np.sum(addimy.T, axis=1, dtype=float)
    #convert to mag and phase... why didn't i just load the mag and phase...?
    MagX = np.sqrt(addrex**2 + addimx**2)
    PhaX = np.arctan2(addimx, addrex)
    MagY = np.sqrt(addrey**2 + addimy**2)
    PhaY = np.arctan2(addimy, addrey)
    #convert mag phase to intensity
    itx = (MagX*np.cos(PhaX))**2 + (MagX*np.sin(PhaX))**2
    ity = (MagY*np.cos(PhaY))**2 + (MagY*np.sin(PhaY))**2
    it = itx[:] + ity[:]
    #print("it shape: ", it.shape, cnt)
    return data['Xpos'], data['Ypos'], it
```

```{python}
x, y, i1 = calculate_intensity_4_baseline([60,64], '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/')
x, y, i2 = calculate_intensity_4_baseline([1,5], '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/')
```

```{python}
plt.scatter(x, y, c=i1)
```

```{python}
qbrep = '/media/james/DATA/GRASPdata/DavesTabSourceFIModel/MODALfiles/'
my150dat = '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/'
files = sorted(glob.glob(my150dat+'*.qb'))
print('read', len(files), 'files')
```

```{python}
FIhorns = np.linspace(1,400,400, dtype=int)

tdrow1 = np.linspace(120, 127, 8, dtype=int)
tdrow2 = np.linspace(142, 149, 8, dtype=int)
tdrow3 = np.linspace(164, 171, 8, dtype=int)
tdrow4 = np.linspace(186, 193, 8, dtype=int)
tdrow5 = np.linspace(208, 215, 8, dtype=int)
tdrow6 = np.linspace(230, 237, 8, dtype=int)
tdrow7 = np.linspace(252, 259, 8, dtype=int)
tdrow8 = np.linspace(274, 281, 8, dtype=int)
TDhorns = np.concatenate((tdrow1, tdrow2, tdrow3, tdrow4, tdrow5, tdrow6, tdrow7, tdrow8))
#TDhorns.extend(tdrow1, tdrow2)
print(TDhorns.shape, FIhorns.shape)

#example baseline
baseline = [120, 127]
print(baseline)
```

```{python}
d = qubic.qubicdict.qubicDict()
d.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
d['config'] = 'FI'
q = qubic.QubicInstrument(d)

centers = q.horn.center[:, 0:2]
col = q.horn.column
row = q.horn.row

instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open

hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()
for i in range(len(centers)):
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
    
instTD.horn.plot()
plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
# tdpair1 = [60,64]
# tdpair2 = [1, 5]

# tdpair1 = [1,57]
# tdpair2 = [57, 64]

tdpair1 = [29,31]
tdpair2 = [42, 44]

fipair1 = [int(FIhorns[np.where(TDhornsFIconf == tdpair1[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair1[1])])]
fipair2 = [int(FIhorns[np.where(TDhornsFIconf == tdpair2[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair2[1])])]

print(tdpair1, fipair1)

x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diff = p1i-p2i
print(max(diff), sum(abs(diff)), sum(p1i), "%diff", 100*sum(abs(diff))/sum(p1i), "RMSE", RMSE(p1i,p2i))
# # %matplotlib notebook
# # %matplotlib notebook

xr = x*np.cos(np.pi) + y*np.sin(np.pi)
yr = y*np.cos(np.pi) - x*np.sin(np.pi)
    
    
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 12}
plt.rc('font', **font)


baseline_plotter(x, y, p1i, p2i, diff, TDhornsFIconf, instTD.horn,  tdpair1, tdpair2, centers, virtual_diff=False)


#baseline_plotter_FI(x, y, p1i, p2i, diff, TDhornsFIconf, instTD.horn,  tdpair1, tdpair2, centers, virtual_diff=False)
```

```{python}

```

```{python}
fipair1 = [190, 192]
fipair2 = [231, 400]
x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diff2 = p1i-p2i
print(max(diff2), sum(abs(diff2)), sum(p1i), "%diff", 100*sum(abs(diff2))/sum(p1i), "RMSE", RMSE(p1i,p2i))

baseline_plotter_FI(x, y, p1i, p2i, diff2, instFI.horn,  fipair1, fipair2, centers, virtual_diff=False)


```

```{python}
print(np.where(y==0, x, x))

font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
# %matplotlib inline
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

plt.plot(np.where(y==0, x, x), np.where(y==0, diff2, diff2), '.', color='xkcd:burnt orange', 
         label='Arbitrary Baselines {}{}'.format(fipair1, fipair2))
plt.plot(np.where(y==0, x, x), np.where(y==0, diff, diff), '.', color='xkcd:sea green', alpha=0.1, 
         label='Equivalent Baselines [{}, {}][{}, {}]'.format(int(FIhorns[np.where(TDhornsFIconf == tdpair1[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair1[1])]),
        int(FIhorns[np.where(TDhornsFIconf == tdpair2[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair2[1])])))
# plt.plot(diff2, '.', color='xkcd:burnt orange')
# plt.plot(diff, '.', color='xkcd:sea green', alpha=0.1)
plt.xlabel('X Cut (m)')
plt.ylabel('Residual Difference (W)')
#plt.legend(loc='upper right')
leg = plt.legend(loc='upper right')

for lh in leg.legendHandles: 
    lh._legmarker.set_alpha(1)
    lh._legmarker.set_markersize(15)

#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/residcomp.png')
```

```{python}
# def tbp(x, y, p1i, p2i, diff, instFI, fipair1, fipair2, centers, virtual_diff=False):
#     """elaborate baseline comparison plot
#     use show_baseline_types script to use this function"""
    
#     plt.figure(figsize=(10,8))
#     plt.subplot(2,2,1)
#     plt.scatter(x, y, c=p1i/max(p1i))
#     plt.title('Horns: {} & {}'.format(int(fipair1[0]), int(fipair1[1])))
#     plt.colorbar(label='Normalised Intensity (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,2)
#     plt.scatter(x, y, c=p2i/max(p2i))
#     plt.title('Horns: {} & {}'.format(int(fipair2[0]), int(fipair2[1])))
#     plt.colorbar(label='Normalised Intensity (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,4)
    
#     if virtual_diff is True:
#         plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
#     if virtual_diff is False:
#         plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
#     plt.title('Residual Difference')
#     plt.colorbar(label='Normalised Intensity Difference (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,3)
#     instFI.plot()
#     plt.plot(centers[fipair1[0]-1, 0], centers[fipair1[0]-1, 1],
#              'o', color='xkcd:burnt orange', markersize=7, mfc = None)
#     plt.plot(centers[fipair1[1]-1, 0], centers[fipair1[1]-1, 1],
#              'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
#     plt.plot(centers[fipair2[0]-1, 0], centers[fipair2[0]-1, 1],
#              'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
#     plt.plot(centers[fipair2[1]-1, 0], centers[fipair2[1]-1, 1],
#              'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
#     plt.title('Horn Array')
#     plt.xlabel('Horn Array X (m)')
#     plt.ylabel('Horn Array Y (m)')
#     plt.axis('equal')

#     plt.tight_layout()
    
fipair1 = [190, 192]
fipair2 = [211, 213]
fipair3 = [1, 3]
fipair4 = [398, 400]
x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
x, y, p3i = calculate_intensity_4_baseline(fipair3, my150dat)
x, y, p4i = calculate_intensity_4_baseline(fipair4, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diffc = p1i-p2i

p3i = p3i/max(p3i)
p4i = p4i/max(p4i)
difff = p3i-p4i

# %matplotlib notebook
plt.figure(figsize=(10,10))
instFI.horn.plot()
plt.plot(centers[fipair1[0]-1, 0], centers[fipair1[0]-1, 1],
         'o', color='xkcd:burnt orange', markersize=7, mfc = None)
plt.plot(centers[fipair1[1]-1, 0], centers[fipair1[1]-1, 1],
         'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
plt.plot(centers[fipair2[0]-1, 0], centers[fipair2[0]-1, 1],
         'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
plt.plot(centers[fipair2[1]-1, 0], centers[fipair2[1]-1, 1],
         'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
plt.plot(centers[fipair3[0]-1, 0], centers[fipair3[0]-1, 1],
         'o', color='xkcd:amber', markersize=7, mfc = None)
plt.plot(centers[fipair3[1]-1, 0], centers[fipair3[1]-1, 1],
         'o', color='xkcd:amber', markersize=7, alpha=1, mfc = None)
plt.plot(centers[fipair4[0]-1, 0], centers[fipair4[0]-1, 1],
         'o', color='xkcd:cobalt', markersize=7, alpha=1, mfc = None)
plt.plot(centers[fipair4[1]-1, 0], centers[fipair4[1]-1, 1],
         'o', color='xkcd:cobalt', markersize=7, alpha=1, mfc = None)
plt.title('Horn Array')
plt.xlabel('Horn Array X (m)')
plt.ylabel('Horn Array Y (m)')
plt.axis('equal')

plt.tight_layout()
```

```{python}
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
# %matplotlib inline
plt.rc('font', **font)
plt.figure(figsize=(16, 8))
plt.plot(np.where(y==0, x, x), np.where(y==0, difff, difff), '.', color='xkcd:cobalt', 
         label='Far Baselines {}{}'.format(fipair3, fipair4))
plt.plot(np.where(y==0, x, x), np.where(y==0, diffc, diffc), '.', color='xkcd:strawberry', alpha=0.1,
         label='Close Baselines {}{}'.format(fipair1, fipair2))

# plt.plot(diff2, '.', color='xkcd:burnt orange')
# plt.plot(diff, '.', color='xkcd:sea green', alpha=0.1)
plt.xlabel('X Cut (m)')
plt.ylabel('Residual Difference (W)')
#plt.legend(loc='upper right')
leg = plt.legend(loc='upper right')

for lh in leg.legendHandles: 
    lh._legmarker.set_alpha(1)
    lh._legmarker.set_markersize(15)
```

```{python}
# maxd = max(abs(diff))
# maxd2 = max(abs(diff2))


# histogram, bins = np.histogram(diff, bins=101, range=(-maxd, maxd), density=True)
# histogram2, bins2 = np.histogram(diff2, bins=101, range=(-maxd2, maxd2), density=True)
# # histogram, bins = np.histogram(diff, bins=25, range=(-maxd2, maxd2), density=True)
# # histogram2, bins2 = np.histogram(diff2, bins=25, range=(-maxd2, maxd2), density=True)

# font = {'family' : 'normal',
#         'weight' : 'normal',
#         'size'   : 20}
# plt.rc('font', **font)
# plt.figure(figsize=(16, 8))

# plt.plot(bins[0:101],histogram, label="Distribution of residuals"+'\n'+'p1{} p2{}'.format(tdpair1, tdpair2), lw=3)
# plt.plot(bins2[0:101],histogram2, label="Distribution of ARBI residuals"+'\n'+'p1{} p2{}'.format(tdpair1, tdpair2), lw=3)

# plt.xlabel('Residual')
# plt.ylabel('Frequency')
# plt.legend(loc='upper right')
# plt.show()
```

```{python}
"""from here do the thesis plots"""

```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)
h190 = (col == 12) & (row == 11)
h193 = (col == 15) & (row == 11)
h200 = (col == 22) & (row == 11)
h387 = (col == 12) & (row == 21)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False
instTD.horn.open[h190] = True
instTD.horn.open[h193] = True
instTD.horn.open[h200] = True
instTD.horn.open[h387] = True

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()

for i in range(len(centers)):
    plt.text(centers[i,0]-0.005, centers[i,1]-0.004, '{0:}'.format(str(i+1)), color='g',fontsize=8)
    plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
    plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
#     if hornsTD[i] == True:
#         plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
#         plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
#         plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
#         TDhornsFIconf[i] = cnt
        
#         cnt+=1
instTD.horn.plot()    

plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
#instTD = qubic.QubicInstrument(d)
#instTD.horn.open[~hornsTD] = False

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(14,14))
q.horn.plot()
for i in range(len(centers)):
    plt.text(centers[i,0]-0.005, centers[i,1]-0.004, '{0:}'.format(str(i+1)), color='g',fontsize=12)
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], '{0:}'.format(str(cnt)), color='r',fontsize=12)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
    
instFI.horn.plot()
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.show()

```

```{python}
horn = 190
print(my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb')
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'

fi = QB_add_intensity_anyhorns(my150dat)
```

```{python}
tdi = QB_add_intensity_anyhorns(my150dat, config='TD')
```

```{python}
plt.figure(figsize=(10,8))
plt.scatter(xdat, ydat, c=fi/max(fi))
plt.figure(figsize=(10,8))
plt.scatter(xdat, ydat, c=tdi/max(tdi))
```

```{python}
#set up first row
horn = 190
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
shx, shy, shi = IntensityCalcRAW(sfile)
data = np.loadtxt(sfile, skiprows=1)
xdat = data[:,2]
ydat = data[:,3]

#setup 2nd row
horn2 = 193
file2 = my150dat+'FP_planar_grid_horn'+str(horn2)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i = calculate_intensity_4_baseline([horn, horn2], my150dat)

#setup 3rd row
horn3 = 200
file3 = my150dat+'FP_planar_grid_horn'+str(horn3)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i3 = calculate_intensity_4_baseline([horn, horn3], my150dat)

#setup 4th row
horn4 = 387
file3 = my150dat+'FP_planar_grid_horn'+str(horn4)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i4 = calculate_intensity_4_baseline([horn, horn4], my150dat)


plt.figure(figsize=(10,24))

instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False

plt.subplot(6,2,1)
instTD.horn.open[h190] = True
instTD.horn.plot()    
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,2)
plt.scatter(xdat, ydat, c=shi/max(shi))
#plt.title('Horns: {} & {}'.format(int(tdpair1[0]), int(tdpair1[1])))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,3)
#instTD.horn.open[h190] = True
instTD.horn.open[h193] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn2-1,0]-0.005, centers[horn2-1,1]+0.005, '{0:}'.format(str(horn2)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn2-1,0], centers[horn2-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,4)
plt.scatter(x, y, c=i/max(i))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))


plt.subplot(6,2,5)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn3-1,0]-0.005, centers[horn3-1,1]+0.005, '{0:}'.format(str(horn3)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,6)
plt.scatter(x, y, c=i3/max(i3))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,7)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = False
instTD.horn.open[h387] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn4-1,0]-0.005, centers[horn4-1,1]+0.005, '{0:}'.format(str(horn4)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,8)
plt.scatter(x, y, c=i4/max(i4))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,9)
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open
hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)
### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
instTD.horn.plot()

plt.subplot(6,2,10)
plt.scatter(x, y, c=tdi/max(tdi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,11)
q.horn.plot()

plt.subplot(6,2,12)
plt.scatter(x, y, c=fi/max(fi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.tight_layout()
#plt.savefig('/media/james/DATA/baseline_figures/results_cmeancrit.png')
#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/horn_demo.png')
```

```{python}
"""different baseline plot for ray trace section"""
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False
instTD.horn.open[1-1] = True
instTD.horn.open[134-1] = True
instTD.horn.open[267-1] = True
instTD.horn.open[400-1] = True

# cnt = 1
# TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()

plt.text(centers[1-1,0]-0.003, centers[1-1,1]-0.003, '{0:}'.format(str(1)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[134-1,0]-0.007, centers[134-1,1]-0.003, '{0:}'.format(str(134)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[267-1,0]-0.007, centers[267-1,1]-0.003, '{0:}'.format(str(267)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[400-1,0]-0.007, centers[400-1,1]-0.003, '{0:}'.format(str(400)), color='r',fontsize=10, fontweight='bold')

instTD.horn.plot()    

plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()

#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/zemaxhorns.png')
```

```{python}

```

```{python}

```
