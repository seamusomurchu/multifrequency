---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.6.0
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from CSFPA_dataIO import *
from CSFPA_plots import baseline_plotter
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import glob
import qubic
```

```{python}
"""i beleive this link has the optical data... -> https://maynoothuniversity-my.sharepoint.com/:u:/g/personal/james_murphy_2018_mumail_ie/EWFWx6YTco5ChvdzA1-MWesBTpRqsv30ttpKVwOlI8Ue1w?e=ICYVum"""
```

```{python}
def RMSE_residual(diff):
    """simple RMSE calculation for the residual difference, typically focal plane intensity"""
    return np.sqrt(np.mean((diff)**2))

def baseline_plotter(x, y, p1i, p2i, diff, TDhornsFIconf, instTD, tdpair1, tdpair2, centers, virtual_diff=False):
    """elaborate baseline comparison plot
    use show_baseline_types script to use this function"""
    
    plt.figure(figsize=(10,8))
    plt.subplot(2,2,1)
    plt.scatter(x, y, c=p1i/max(p1i))
    plt.title('Horns: {} & {}'.format(int(tdpair1[0]), int(tdpair1[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,2)
    plt.scatter(x, y, c=p2i/max(p2i))
    plt.title('Horns: {} & {}'.format(int(tdpair2[0]), int(tdpair2[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,4)
    
    if virtual_diff is True:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
    if virtual_diff is False:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
    plt.title('Residual Difference')
    plt.colorbar(label='Normalised Intensity Difference (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,3)
    instTD.plot()
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[0]), 0], centers[np.where(TDhornsFIconf == tdpair1[0]), 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[1]), 0], centers[np.where(TDhornsFIconf == tdpair1[1]), 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[0]), 0], centers[np.where(TDhornsFIconf == tdpair2[0]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[1]), 0], centers[np.where(TDhornsFIconf == tdpair2[1]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def baseline_plotter_FI(x, y, p1i, p2i, diff, instFI, fipair1, fipair2, centers, virtual_diff=False):
    """elaborate baseline comparison plot
    use show_baseline_types script to use this function"""
    
    plt.figure(figsize=(10,8))
    plt.subplot(2,2,1)
    plt.scatter(x, y, c=p1i/max(p1i))
    plt.title('Horns: {} & {}'.format(int(fipair1[0]), int(fipair1[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,2)
    plt.scatter(x, y, c=p2i/max(p2i))
    plt.title('Horns: {} & {}'.format(int(fipair2[0]), int(fipair2[1])))
    plt.colorbar(label='Normalised Intensity (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,4)
    
    if virtual_diff is True:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
    if virtual_diff is False:
        plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
    plt.title('Residual Difference')
    plt.colorbar(label='Normalised Intensity Difference (W)')
    plt.xlabel('Focal Plane X (m)')
    plt.ylabel('Focal Plane Y (m)')
    plt.xlim(min(x), max(x))
    plt.ylim(min(y), max(y))
    plt.subplot(2,2,3)
    instFI.plot()
    plt.plot(centers[fipair1[0]-1, 0], centers[fipair1[0]-1, 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[fipair1[1]-1, 0], centers[fipair1[1]-1, 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[fipair2[0]-1, 0], centers[fipair2[0]-1, 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[fipair2[1]-1, 0], centers[fipair2[1]-1, 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def simple_baseline_plotter(TDhornsFIconf, tdpair1, tdpair2, centers):
    """elaborate baseline comparison plot
    requires you have qubic inst loaded e.g.
    instFI = qubic.QubicInstrument(d)
    hornsFI = instFI.horn.open
    hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
    ### Now create First Instrument and TD monochromatic
    instTD = qubic.QubicInstrument(d)
    instTD.horn.open[~hornsTD] = False"""
    import qubic
    d = qubic.qubicdict.qubicDict()
    d.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
    d['config'] = 'FI'
    q = qubic.QubicInstrument(d)
    centers = q.horn.center[:, 0:2]
    col = q.horn.column
    row = q.horn.row
    instFI = qubic.QubicInstrument(d)
    hornsFI = instFI.horn.open
    hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
    instTD = qubic.QubicInstrument(d)
    instTD.horn.open[~hornsTD] = False
    
    plt.figure(figsize=(14,14))

    instTD.horn.plot()
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[0]), 0], centers[np.where(TDhornsFIconf == tdpair1[0]), 1],
             'o', color='xkcd:burnt orange', markersize=7, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair1[1]), 0], centers[np.where(TDhornsFIconf == tdpair1[1]), 1],
             'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[0]), 0], centers[np.where(TDhornsFIconf == tdpair2[0]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.plot(centers[np.where(TDhornsFIconf == tdpair2[1]), 0], centers[np.where(TDhornsFIconf == tdpair2[1]), 1],
             'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
    plt.title('Horn Array')
    plt.xlabel('Horn Array X (m)')
    plt.ylabel('Horn Array Y (m)')
    plt.axis('equal')

    plt.tight_layout()
    
def calculate_intensity_4_baseline(baseline, datadir):
    
    #initial load to setup arrays, could be improved!
    data = pd.read_csv(datadir+'FP_planar_grid_horn'+str(100)+'_150_GHz_Mstyle.qb', sep='\t')
    addimx = np.zeros(len(data['Rex']))
    addrex = np.zeros(len(data['Rex']))
    addrey = np.zeros(len(data['Rex']))
    addimy = np.zeros(len(data['Rex']))

    #here we loop through the chosen config, baseline, load the 'qb' files
    #and add the instensities

    #baseline, TDhorns, FIhorns all interchangeable here
    cnt = 0
    for horn in baseline:

        #print(datadir+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb')
        file = datadir+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
        data = pd.read_csv(file, sep='\t')
        #print(data.shape)

        #add the relevant compnents to an array
        addrex = np.vstack((addrex, data['Rex']))
        addimx = np.vstack((addimx, data['Imx']))
        addrey = np.vstack((addrey, data['Rey']))
        addimy = np.vstack((addimy, data['Imy']))

        cnt+=1

    #add / flatten the array
    addrex = np.sum(addrex.T, axis=1, dtype=float)
    addimx = np.sum(addimx.T, axis=1, dtype=float)
    addrey = np.sum(addrey.T, axis=1, dtype=float)
    addimy = np.sum(addimy.T, axis=1, dtype=float)
    #convert to mag and phase... why didn't i just load the mag and phase...?
    MagX = np.sqrt(addrex**2 + addimx**2)
    PhaX = np.arctan2(addimx, addrex)
    MagY = np.sqrt(addrey**2 + addimy**2)
    PhaY = np.arctan2(addimy, addrey)
    #convert mag phase to intensity
    itx = (MagX*np.cos(PhaX))**2 + (MagX*np.sin(PhaX))**2
    ity = (MagY*np.cos(PhaY))**2 + (MagY*np.sin(PhaY))**2
    it = itx[:] + ity[:]
    #print("it shape: ", it.shape, cnt)
    return data['Xpos'], data['Ypos'], it
```

```{python}
x, y, i1 = calculate_intensity_4_baseline([60,64], '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/')
x, y, i2 = calculate_intensity_4_baseline([1,5], '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/')
```

```{python}
plt.scatter(x, y, c=i1)
```

```{python}
qbrep = '/media/james/DATA/GRASPdata/DavesTabSourceFIModel/MODALfiles/'
my150dat = '/media/james/DATA/GRASPdata/MyTabSourceFIModel/150GHz/MODALfiles/'
files = sorted(glob.glob(my150dat+'*.qb'))
print('read', len(files), 'files')
```

```{python}
FIhorns = np.linspace(1,400,400, dtype=int)

tdrow1 = np.linspace(120, 127, 8, dtype=int)
tdrow2 = np.linspace(142, 149, 8, dtype=int)
tdrow3 = np.linspace(164, 171, 8, dtype=int)
tdrow4 = np.linspace(186, 193, 8, dtype=int)
tdrow5 = np.linspace(208, 215, 8, dtype=int)
tdrow6 = np.linspace(230, 237, 8, dtype=int)
tdrow7 = np.linspace(252, 259, 8, dtype=int)
tdrow8 = np.linspace(274, 281, 8, dtype=int)
TDhorns = np.concatenate((tdrow1, tdrow2, tdrow3, tdrow4, tdrow5, tdrow6, tdrow7, tdrow8))
#TDhorns.extend(tdrow1, tdrow2)
print(TDhorns.shape, FIhorns.shape)

#example baseline
baseline = [120, 127]
print(baseline)
```

```{python}
d = qubic.qubicdict.qubicDict()
d.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
d['config'] = 'FI'
q = qubic.QubicInstrument(d)

centers = q.horn.center[:, 0:2]
col = q.horn.column
row = q.horn.row

instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open

hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()
for i in range(len(centers)):
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
    
instTD.horn.plot()
plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
# tdpair1 = [60,64]
# tdpair2 = [1, 5]

# tdpair1 = [1,57]
# tdpair2 = [57, 64]

tdpair1 = [29,31]
tdpair2 = [42, 44]

fipair1 = [int(FIhorns[np.where(TDhornsFIconf == tdpair1[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair1[1])])]
fipair2 = [int(FIhorns[np.where(TDhornsFIconf == tdpair2[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair2[1])])]

print(tdpair1, fipair1)

x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diff = p1i-p2i
print(max(diff), sum(abs(diff)), sum(p1i), "%diff", 100*sum(abs(diff))/sum(p1i), "RMSE", RMSE(p1i,p2i))
# # %matplotlib notebook
# # %matplotlib notebook

xr = x*np.cos(np.pi) + y*np.sin(np.pi)
yr = y*np.cos(np.pi) - x*np.sin(np.pi)
    
# %matplotlib notebook
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 12}
plt.rc('font', **font)


baseline_plotter(x, y, p1i, p2i, diff, TDhornsFIconf, instTD.horn,  tdpair1, tdpair2, centers, virtual_diff=False)


#baseline_plotter_FI(x, y, p1i, p2i, diff, TDhornsFIconf, instTD.horn,  tdpair1, tdpair2, centers, virtual_diff=False)
```

```{python}
fipair1EQ = [190, 192]
fipair2EQ = [211, 213]
x, y, p1i = calculate_intensity_4_baseline(fipair1EQ, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2EQ, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diffEQ = p1i-p2i
#print(max(diff2), sum(abs(diff2)), sum(p1i), "%diff", 100*sum(abs(diff2))/sum(p1i), "RMSE", RMSE(p1i,p2i))
plt.style.use('default')
baseline_plotter_FI(x, y, p1i, p2i, diffEQ, instFI.horn,  fipair1EQ, fipair2EQ, centers, virtual_diff=False)
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/moreEQ.png', dpi=300, facecolor='w')
```

```{python}
fipair1ARB = [190, 192]
fipair2ARB = [211, 212]
x, y, p1i = calculate_intensity_4_baseline(fipair1ARB, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2ARB, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diffARB = p1i-p2i
print(max(diffARB), sum(abs(diffARB)), sum(p1i), "%diff", 100*sum(abs(diffARB))/sum(p1i), "RMSE", RMSE(p1i,p2i))

baseline_plotter_FI(x, y, p1i, p2i, diffARB, instFI.horn,  fipair1ARB, fipair2ARB, centers, virtual_diff=False)


```

```{python}
"""test another arbitary pair"""
fipair1ARB2 = [378, 255]
fipair2ARB2 = [29, 46]
x, y, p1i = calculate_intensity_4_baseline(fipair1ARB2, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2ARB2, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diffARB2 = p1i-p2i
print(max(diffARB2), sum(abs(diffARB2)), sum(p1i), "%diff", 100*sum(abs(diffARB2))/sum(p1i), "RMSE", RMSE(p1i,p2i))

baseline_plotter_FI(x, y, p1i, p2i, diffARB2, instFI.horn,  fipair1ARB2, fipair2ARB2, centers, virtual_diff=False)


```

```{python}
# %matplotlib inline
plt.figure(figsize=(16,8))
plt.plot(p1i, '.')
plt.plot(p2i, '.')
plt.plot(p1i-p2i, '.')

print(sum(p1i), sum(p2i))
```

```{python}
fipair1farEQ = [1, 3]
fipair2farEQ = [398, 400]
x, y, p1i = calculate_intensity_4_baseline(fipair1farEQ, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2farEQ, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
difffarEQ = p1i-p2i
#print(max(diff2), sum(abs(diff2)), sum(p1i), "%diff", 100*sum(abs(diff2))/sum(p1i), "RMSE", RMSE(p1i,p2i))
# %matplotlib notebook
baseline_plotter_FI(x, y, p1i, p2i, difffarEQ, instFI.horn,  fipair1farEQ, fipair2farEQ, centers, virtual_diff=False)


```

```{python}
print(diff.shape)
```

```{python}
#print(np.where(y==0, x, x))

font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
# %matplotlib inline
# plt.rc('font', **font)
# plt.figure(figsize=(16, 8))

# plt.plot(np.where(y==0, x, x), np.where(y==0, diff2, diff2), '.', color='xkcd:burnt orange', 
#          label='Arbitrary Baselines {}{}'.format(fipair1, fipair2))
# plt.plot(np.where(y==0, x, x), np.where(y==0, diff, diff), '.', color='xkcd:sea green', alpha=0.1, 
#          label='Equivalent Baselines [{}, {}][{}, {}]'.format(int(FIhorns[np.where(TDhornsFIconf == tdpair1[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair1[1])]),
#         int(FIhorns[np.where(TDhornsFIconf == tdpair2[0])]), int(FIhorns[np.where(TDhornsFIconf == tdpair2[1])])))
# # plt.plot(diff2, '.', color='xkcd:burnt orange')
# # plt.plot(diff, '.', color='xkcd:sea green', alpha=0.1)
# plt.xlabel('X Cut (m)')
# plt.ylabel('Residual Difference (W)')
# #plt.legend(loc='upper right')
# leg = plt.legend(loc='upper right')

# for lh in leg.legendHandles: 
#     lh._legmarker.set_alpha(1)
#     lh._legmarker.set_markersize(15)

#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/residcomp.png')


plt.figure(figsize=(16, 8))
histogramARB, binsARB, = np.histogram(diffARB, bins=101, range=(min(diffARB), max(diffARB)), density=False)
histogramEQ, binsEQ = np.histogram(diffEQ, bins=101, range=(min(diffARB), max(diffARB)), density=False)
histogramfarEQ, binsfarEQ = np.histogram(difffarEQ, bins=101, range=(min(diffARB), max(diffARB)), density=False)


font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

plt.plot(binsEQ[0:101],histogramEQ, color='xkcd:sea green', 
         label='Equivalent Baseline \n {}{}'.format(fipair1EQ, fipair2EQ), lw=3)

plt.plot(binsARB[0:101],histogramARB,  color='xkcd:burnt orange', 
         label='Arbitrary Baseline \n {}{}'.format(fipair1ARB, fipair2ARB), lw=3)

plt.plot(binsfarEQ[0:101],histogramfarEQ,  color='xkcd:blue', 
         label='far Equivalent Baseline \n {}{}'.format(fipair1farEQ, fipair2farEQ), lw=3)

plt.xlabel('Residual Difference (W)')
plt.ylabel('Frequency')
plt.legend(loc='upper left')
#plt.show()
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/residcomp_hist2.png', dpi=300, facecolor='w')
```

```{python}
# def tbp(x, y, p1i, p2i, diff, instFI, fipair1, fipair2, centers, virtual_diff=False):
#     """elaborate baseline comparison plot
#     use show_baseline_types script to use this function"""
    
#     plt.figure(figsize=(10,8))
#     plt.subplot(2,2,1)
#     plt.scatter(x, y, c=p1i/max(p1i))
#     plt.title('Horns: {} & {}'.format(int(fipair1[0]), int(fipair1[1])))
#     plt.colorbar(label='Normalised Intensity (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,2)
#     plt.scatter(x, y, c=p2i/max(p2i))
#     plt.title('Horns: {} & {}'.format(int(fipair2[0]), int(fipair2[1])))
#     plt.colorbar(label='Normalised Intensity (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,4)
    
#     if virtual_diff is True:
#         plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG', vmin=-0.1, vmax=0.1)
#     if virtual_diff is False:
#         plt.scatter(x, y, c=diff/max(p1i),  cmap='PiYG')#, vmin=-1, vmax=1) #vmin=0, vmax=1,
        
#     plt.title('Residual Difference')
#     plt.colorbar(label='Normalised Intensity Difference (W)')
#     plt.xlabel('Focal Plane X (m)')
#     plt.ylabel('Focal Plane Y (m)')
#     plt.xlim(min(x), max(x))
#     plt.ylim(min(y), max(y))
#     plt.subplot(2,2,3)
#     instFI.plot()
#     plt.plot(centers[fipair1[0]-1, 0], centers[fipair1[0]-1, 1],
#              'o', color='xkcd:burnt orange', markersize=7, mfc = None)
#     plt.plot(centers[fipair1[1]-1, 0], centers[fipair1[1]-1, 1],
#              'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
#     plt.plot(centers[fipair2[0]-1, 0], centers[fipair2[0]-1, 1],
#              'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
#     plt.plot(centers[fipair2[1]-1, 0], centers[fipair2[1]-1, 1],
#              'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
#     plt.title('Horn Array')
#     plt.xlabel('Horn Array X (m)')
#     plt.ylabel('Horn Array Y (m)')
#     plt.axis('equal')

#     plt.tight_layout()
    
fipair1 = [190, 192]
fipair2 = [211, 213]
fipair3 = [1, 3]
fipair4 = [398, 400]
x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)
x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
x, y, p3i = calculate_intensity_4_baseline(fipair3, my150dat)
x, y, p4i = calculate_intensity_4_baseline(fipair4, my150dat)
#print(p1i.shape, p2i.shape)
p1i = p1i/max(p1i)
p2i = p2i/max(p2i)
diffc = p1i-p2i

p3i = p3i/max(p3i)
p4i = p4i/max(p4i)
difff = p3i-p4i

#setup close horns
instFI.horn.open[:] = False

# %matplotlib notebook
plt.figure(figsize=(10,10))
instFI.horn.plot()

plt.plot(centers[fipair1[0]-1, 0]-0.0001, centers[fipair1[0]-1, 1]+0.0001,
         'o', color='xkcd:burnt orange', markersize=22, mfc = None)
plt.plot(centers[fipair1[1]-1, 0]-0.0001, centers[fipair1[1]-1, 1]+0.0001,
         'o', color='xkcd:burnt orange', markersize=22, alpha=1, mfc = None)
plt.plot(centers[fipair2[0]-1, 0]-0.0001, centers[fipair2[0]-1, 1]+0.0001,
         'o', color='xkcd:sea green', markersize=22, alpha=1, mfc = None)
plt.plot(centers[fipair2[1]-1, 0]-0.0001, centers[fipair2[1]-1, 1]+0.0001,
         'o', color='xkcd:sea green', markersize=22, alpha=1, mfc = None)
plt.plot(centers[fipair3[0]-1, 0]-0.0002, centers[fipair3[0]-1, 1]+0.0002,
         'o', color='xkcd:amber', markersize=22, mfc = None)
plt.plot(centers[fipair3[1]-1, 0]-0.0002, centers[fipair3[1]-1, 1]+0.0002,
         'o', color='xkcd:amber', markersize=22, alpha=1, mfc = None)
plt.plot(centers[fipair4[0]-1, 0]-0.0001, centers[fipair4[0]-1, 1]+0.0001,
         'o', color='xkcd:cobalt', markersize=22, alpha=1, mfc = None)
plt.plot(centers[fipair4[1]-1, 0]-0.0001, centers[fipair4[1]-1, 1]+0.0001,
         'o', color='xkcd:cobalt', markersize=22, alpha=1, mfc = None)
#plt.title('Horn Array')
plt.xlabel('Horn Array X (m)')
plt.ylabel('Horn Array Y (m)')
plt.axis('equal')

plt.tight_layout()
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/maxdiff.png')
```

```{python}
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
# %matplotlib inline
plt.rc('font', **font)
plt.figure(figsize=(16, 8))
plt.plot(np.where(y==0, x, x), np.where(y==0, difff, difff), '.', color='xkcd:cobalt', 
         label='Far Baselines {}{}'.format(fipair3, fipair4))
plt.plot(np.where(y==0, x, x), np.where(y==0, diffEQ, diffEQ), '.', color='xkcd:sea green', alpha=0.1,
         label='Close Baselines {}{}'.format(fipair1EQ, fipair2EQ))

# plt.plot(diff2, '.', color='xkcd:burnt orange')
# plt.plot(diff, '.', color='xkcd:sea green', alpha=0.1)
plt.xlabel('X Cut (m)')
plt.ylabel('Residual Difference (W)')
#plt.legend(loc='upper right')
leg = plt.legend(loc='upper right')

for lh in leg.legendHandles: 
    lh._legmarker.set_alpha(1)
    lh._legmarker.set_markersize(15)
    
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/maxdiffresids.png')
```

```{python}
maxd = max(abs(difff))
maxd2 = max(abs(diffc))
print(len(difff))

"""changing to a v2 with a normalisation"""

# histogram, bins = np.histogram(difff, bins=101, range=(-maxd, maxd), density=False)
# histogram2, bins2 = np.histogram(diffc, bins=101, range=(-maxd2, maxd2), density=False)
# # histogram, bins = np.histogram(diff, bins=25, range=(-maxd2, maxd2), density=True)
# # histogram2, bins2 = np.histogram(diff2, bins=25, range=(-maxd2, maxd2), density=True)

# font = {'family' : 'normal',
#         'weight' : 'normal',
#         'size'   : 20}
# plt.rc('font', **font)
# plt.figure(figsize=(16, 8))

# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt', label="Far baseline", lw=3)
# plt.plot(bins2[0:101],histogram2, color='xkcd:strawberry', label="Close baseline", lw=3)

# plt.xlabel('Residual Difference (W)')
# plt.ylabel('Frequency')
# plt.legend(loc='upper right')
# plt.show()

# #plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/residhisto.png')

bintest = np.linspace(-0.5,0.5,101)

histogramEQ, binsEQ = np.histogram(diffEQ, bins=bintest, density=False)
histogramf, binsf = np.histogram(difff, bins=bintest, density=False)
# histogram, bins = np.histogram(diff, bins=25, range=(-maxd2, maxd2), density=True)
# histogram2, bins2 = np.histogram(diff2, bins=25, range=(-maxd2, maxd2), density=True)
histogramARB, binsARB, = np.histogram(diffARB, bins=bintest, density=False)

font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))
plt.plot(binsEQ[0:100],histogramEQ, color='xkcd:sea green', 
         label='Close Baselines {}{}'.format(fipair1EQ, fipair2EQ), lw=3)
plt.plot(binsf[0:100],histogramf,  color='xkcd:cobalt', 
         label='Far Baselines {}{}'.format(fipair3, fipair4), lw=3)
plt.plot(binsARB[0:100],histogramARB,  color='xkcd:burnt orange', 
         label='Arbitrary Baselines {}{}'.format(fipair1ARB, fipair2ARB), lw=3)



plt.xlabel('Residual Difference (W)')
plt.ylabel('Frequency')
plt.legend(loc='upper right')
plt.xlim((-1, 1))
#plt.show()

#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/residhisto_v2.png')
```

```{python}
"""from here do the thesis plots"""

```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)
h190 = (col == 12) & (row == 11)
h193 = (col == 15) & (row == 11)
h200 = (col == 22) & (row == 11)
h387 = (col == 12) & (row == 21)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False
instTD.horn.open[h190] = True
instTD.horn.open[h193] = True
instTD.horn.open[h200] = True
instTD.horn.open[h387] = True

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()

for i in range(len(centers)):
    plt.text(centers[i,0]-0.005, centers[i,1]-0.004, '{0:}'.format(str(i+1)), color='g',fontsize=8)
    plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
    plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
#     if hornsTD[i] == True:
#         plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
#         plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
#         plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1], 'td {0:}'.format(str(cnt)), color='r',fontsize=8)
        
#         TDhornsFIconf[i] = cnt
        
#         cnt+=1
instTD.horn.plot()    

plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()
```

```{python}
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open


hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
#instTD = qubic.QubicInstrument(d)
#instTD.horn.open[~hornsTD] = False

cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(14,14))
q.horn.plot()
for i in range(len(centers)):
    plt.text(centers[i,0]-0.005, centers[i,1]-0.004, '{0:}'.format(str(i+1)), color='g',fontsize=12)
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'h {0:}'.format(str(i+1)), color='g',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1], '{0:}'.format(str(cnt)), color='r',fontsize=12)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
    
instFI.horn.plot()
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.show()

```

```{python}
horn = 190
print(my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb')
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'

fi = QB_add_intensity_anyhorns(my150dat)
```

```{python}
tdi = QB_add_intensity_anyhorns(my150dat, config='TD')
```

```{python}
#set up first row
horn = 190
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
shx, shy, shi = IntensityCalcRAW(sfile)
data = np.loadtxt(sfile, skiprows=1)
xdat = data[:,2]
ydat = data[:,3]

plt.figure(figsize=(10,8))
plt.scatter(xdat, ydat, c=fi/max(fi))
plt.figure(figsize=(10,8))
plt.scatter(xdat, ydat, c=tdi/max(tdi))
```

```{python}
#set up first row
horn = 190
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
shx, shy, shi = IntensityCalcRAW(sfile)
data = np.loadtxt(sfile, skiprows=1)
xdat = data[:,2]
ydat = data[:,3]

#setup 2nd row
horn2 = 193
file2 = my150dat+'FP_planar_grid_horn'+str(horn2)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i = calculate_intensity_4_baseline([horn, horn2], my150dat)

#setup 3rd row
horn3 = 200
file3 = my150dat+'FP_planar_grid_horn'+str(horn3)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i3 = calculate_intensity_4_baseline([horn, horn3], my150dat)

#setup 4th row
horn4 = 387
file3 = my150dat+'FP_planar_grid_horn'+str(horn4)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i4 = calculate_intensity_4_baseline([horn, horn4], my150dat)


plt.figure(figsize=(10,24))

instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False

plt.subplot(6,2,1)
instTD.horn.open[h190] = True
instTD.horn.plot()    
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,2)
plt.scatter(xdat, ydat, c=shi/max(shi))
#plt.title('Horns: {} & {}'.format(int(tdpair1[0]), int(tdpair1[1])))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,3)
#instTD.horn.open[h190] = True
instTD.horn.open[h193] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn2-1,0]-0.005, centers[horn2-1,1]+0.005, '{0:}'.format(str(horn2)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn2-1,0], centers[horn2-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,4)
plt.scatter(x, y, c=i/max(i))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))


plt.subplot(6,2,5)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn3-1,0]-0.005, centers[horn3-1,1]+0.005, '{0:}'.format(str(horn3)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,6)
plt.scatter(x, y, c=i3/max(i3))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,7)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = False
instTD.horn.open[h387] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn4-1,0]-0.005, centers[horn4-1,1]+0.005, '{0:}'.format(str(horn4)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)

plt.subplot(6,2,8)
plt.scatter(x, y, c=i4/max(i4))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,9)
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open
hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)
### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
instTD.horn.plot()

plt.subplot(6,2,10)
plt.scatter(x, y, c=tdi/max(tdi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(6,2,11)
q.horn.plot()

plt.subplot(6,2,12)
plt.scatter(x, y, c=fi/max(fi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.tight_layout()
#plt.savefig('/media/james/DATA/baseline_figures/results_cmeancrit.png')
#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/horn_demo.png')
```

```{python}
#set up first row
horn = 190
sfile = my150dat+'FP_planar_grid_horn'+str(horn)+'_150_GHz_Mstyle.qb'
shx, shy, shi = IntensityCalcRAW(sfile)
data = np.loadtxt(sfile, skiprows=1)
xdat = data[:,2]
ydat = data[:,3]

#setup 2nd row
horn2 = 193
file2 = my150dat+'FP_planar_grid_horn'+str(horn2)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i = calculate_intensity_4_baseline([horn, horn2], my150dat)

#setup 3rd row
horn3 = 200
file3 = my150dat+'FP_planar_grid_horn'+str(horn3)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i3 = calculate_intensity_4_baseline([horn, horn3], my150dat)

#setup 4th row
horn4 = 387
file3 = my150dat+'FP_planar_grid_horn'+str(horn4)+'_150_GHz_Mstyle.qb'
#shx, shy, shi = IntensityCalcRAW(file2)
#data = np.loadtxt(sfile, skiprows=1)
x, y, i4 = calculate_intensity_4_baseline([horn, horn4], my150dat)


plt.figure(figsize=(11,18))

instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False

plt.subplot(4,2,1)
instTD.horn.open[h190] = True
instTD.horn.plot()    
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(4,2,2)
plt.scatter(xdat, ydat, c=shi/max(shi))
#plt.title('Horns: {} & {}'.format(int(tdpair1[0]), int(tdpair1[1])))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(4,2,3)
#instTD.horn.open[h190] = True
instTD.horn.open[h193] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn2-1,0]-0.005, centers[horn2-1,1]+0.005, '{0:}'.format(str(horn2)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn2-1,0], centers[horn2-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(4,2,4)
plt.scatter(x, y, c=i/max(i))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))


plt.subplot(4,2,5)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn3-1,0]-0.005, centers[horn3-1,1]+0.005, '{0:}'.format(str(horn3)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(4,2,6)
plt.scatter(x, y, c=i3/max(i3))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(4,2,7)
instTD.horn.open[h193] = False
instTD.horn.open[h200] = False
instTD.horn.open[h387] = True
instTD.horn.plot()
plt.text(centers[horn-1,0]-0.005, centers[horn-1,1]+0.005, '{0:}'.format(str(horn)), color='r',fontsize=12, fontweight='bold')
plt.text(centers[horn4-1,0]-0.005, centers[horn4-1,1]+0.005, '{0:}'.format(str(horn4)), color='r',fontsize=12, fontweight='bold')
#plt.plot(centers[horn-1,0], centers[horn-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
#plt.plot(centers[horn3-1,0], centers[horn3-1,1], 'o', color='xkcd:burnt orange', markersize=8, mfc = None)
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(4,2,8)
plt.scatter(x, y, c=i4/max(i4))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.tight_layout()
#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/horn_demo.png')

plt.figure(figsize=(10,8))

plt.subplot(2,2,1)
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open
hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)
### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[~hornsTD] = False
instTD.horn.plot()
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(2,2,2)
plt.scatter(x, y, c=tdi/max(tdi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.subplot(2,2,3)
q.horn.plot()
plt.ylabel('Horns in GRF Y (m)')
plt.xlabel('Horns in GRF X (m)')

plt.subplot(2,2,4)
plt.scatter(x, y, c=fi/max(fi))
plt.colorbar(label='Normalised Intensity (W)')
plt.xlabel('Focal Plane X (m)')
plt.ylabel('Focal Plane Y (m)')
plt.xlim(min(xdat), max(xdat))
plt.ylim(min(ydat), max(ydat))

plt.tight_layout()
#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/horn_demo.png')
```

```{python}
"""different baseline plot for ray trace section"""
instFI = qubic.QubicInstrument(d)
hornsFI = instFI.horn.open

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(d)
instTD.horn.open[:] = False
instTD.horn.open[1-1] = True
instTD.horn.open[134-1] = True
instTD.horn.open[267-1] = True
instTD.horn.open[400-1] = True

# cnt = 1
# TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
q.horn.plot()

plt.text(centers[1-1,0]-0.003, centers[1-1,1]-0.003, '{0:}'.format(str(1)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[134-1,0]-0.007, centers[134-1,1]-0.003, '{0:}'.format(str(134)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[267-1,0]-0.007, centers[267-1,1]-0.003, '{0:}'.format(str(267)), color='r',fontsize=10, fontweight='bold')
plt.text(centers[400-1,0]-0.007, centers[400-1,1]-0.003, '{0:}'.format(str(400)), color='r',fontsize=10, fontweight='bold')

instTD.horn.plot()    

plt.ylabel('Horn GRF Y (m)')
plt.xlabel('Horn GRF X (m)')

plt.show()

#plt.savefig('/home/james/OneDrive/Thesisv3_revised_layout/Figures/figs_baselines/zemaxhorns.png')
```

```{python}
colors = plt.rcParams["axes.prop_cycle"].by_key()["color"]
print(colors)
```

```{python}
# fipair1 = [5, 7]
# fipair2 = [29, 31]
# fipair3 = [64, 66]
# fipair4 = [103, 105]
# fipair5 = [146, 148]
# fipair6 = [190, 192]
# fipair7 = [234, 236]
# fipair8 = [278, 280]
# fipair9 = [319, 321]
# fipair10 = [356, 358]
# fipair11 = [387, 389]
fipair1 = [5-4, 7-4]
fipair2 = [29-4, 31-4]
fipair3 = [64-4, 66-4]
fipair4 = [103-4, 105-4]
fipair5 = [146-4, 148-4]
fipair6 = [190-4, 192-4]
fipair7 = [234-4, 236-4]
fipair8 = [278-4, 280-4]
fipair9 = [319-4, 321-4]
fipair10 = [356-4, 358-4]
fipair11 = [387-4, 389-4]
fipairtemp = [398, 400]

pairs = [fipair1, fipair2, fipair3, fipair4, fipair5, fipair6, fipair7, fipair8, fipair9, fipair10, 
         fipair11]

x, y, p1i = calculate_intensity_4_baseline(fipair1, my150dat)


intarr = np.zeros([11, 58081])
#print(p1i.shape, intarr.shape)

#calc diffs
for i, pair in enumerate(pairs[1:12]):
    
    x, y, pi = calculate_intensity_4_baseline(pair, my150dat)
    diff = p1i/max(p1i) - pi/max(pi)
    #print(pair, diff.shape)
    intarr[i,:] = diff

#do horn plot
instFI.horn.open[:] = False

#Set3 nice too
cmap = plt.get_cmap("tab20")
cycle = plt.rcParams['axes.prop_cycle'].by_key()['color']

# #%matplotlib notebook
plt.figure(figsize=(10,10))
instFI.horn.plot()
for i, pair in enumerate(pairs):
    #print(pair[0], pair)
    plt.plot(centers[pair[0]-1, 0]-0.0001, centers[pair[0]-1, 1]+0.0001,
          'o', color=cmap(i), markersize=21, mfc = None)
    plt.plot(centers[pair[1]-1, 0]-0.0001, centers[pair[1]-1, 1]+0.0001,
         'o', color=cmap(i), markersize=21, alpha=1, mfc = None)

plt.xlabel('Horn Array X (m)')
plt.ylabel('Horn Array Y (m)')
plt.axis('equal')

#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/rhorns.png')
# x, y, p2i = calculate_intensity_4_baseline(fipair2, my150dat)
# x, y, p3i = calculate_intensity_4_baseline(fipair3, my150dat)
# x, y, p4i = calculate_intensity_4_baseline(fipair4, my150dat)
# #print(p1i.shape, p2i.shape)
# p1i = p1i/max(p1i)
# p2i = p2i/max(p2i)
# diffc = p1i-p2i

# p3i = p3i/max(p3i)
# p4i = p4i/max(p4i)
# difff = p3i-p4i

# #setup close horns
# instFI.horn.open[:] = False

# # %matplotlib notebook
# plt.figure(figsize=(10,10))
# instFI.horn.plot()
# plt.plot(centers[fipair1[0]-1, 0]-0.0001, centers[fipair1[0]-1, 1]+0.0001,
#          'o', color='xkcd:burnt orange', markersize=7, mfc = None)
# plt.plot(centers[fipair1[1]-1, 0]-0.0001, centers[fipair1[1]-1, 1]+0.0001,
#          'o', color='xkcd:burnt orange', markersize=7, alpha=1, mfc = None)
# plt.plot(centers[fipair2[0]-1, 0]-0.0001, centers[fipair2[0]-1, 1]+0.0001,
#          'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
# plt.plot(centers[fipair2[1]-1, 0]-0.0001, centers[fipair2[1]-1, 1]+0.0001,
#          'o', color='xkcd:sea green', markersize=7, alpha=1, mfc = None)
# plt.plot(centers[fipair3[0]-1, 0]-0.0002, centers[fipair3[0]-1, 1]+0.0002,
#          'o', color='xkcd:amber', markersize=7, mfc = None)
# plt.plot(centers[fipair3[1]-1, 0]-0.0002, centers[fipair3[1]-1, 1]+0.0002,
#          'o', color='xkcd:amber', markersize=7, alpha=1, mfc = None)
# plt.plot(centers[fipair4[0]-1, 0]-0.0001, centers[fipair4[0]-1, 1]+0.0001,
#          'o', color='xkcd:cobalt', markersize=7, alpha=1, mfc = None)
# plt.plot(centers[fipair4[1]-1, 0]-0.0001, centers[fipair4[1]-1, 1]+0.0001,
#          'o', color='xkcd:cobalt', markersize=7, alpha=1, mfc = None)
# #plt.title('Horn Array')
# plt.xlabel('Horn Array X (m)')
# plt.ylabel('Horn Array Y (m)')
# plt.axis('equal')

# plt.tight_layout()
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/hornsandr.png')
```

```{python}

```

```{python}


# %matplotlib inline
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

alp = np.linspace(1, 0.1, 11)
bintest = np.linspace(-1,1,101)

for i, pair in enumerate(pairs[1:12]):
    print(i, max(intarr[i,:]), pair, 1)
    histogram, bins = np.histogram(intarr[i,:], bins=101, density=False)
    plt.plot(bins[0:101],histogram,  color=cmap(i+1), label="[1, 3] difference to {}".format(pair), 
             lw=3)

# histogram, bins = np.histogram(intarr[10,:], bins=101, density=False)
# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt blue', label="[1, 3] difference to 398, 400", 
#              lw=3)

# histogramf, binsf = np.histogram(difff, bins=101, density=False)
# plt.plot(binsf[0:101],histogramf,  color='xkcd:brown', label="[1, 3] difference to 398, 400", 
#              lw=3)
plt.plot(binsARB[0:100],histogramARB,  color='xkcd:burnt orange', 
     label='Arbitrary Baselines {}{}'.format(fipair1ARB, fipair2ARB), lw=3) 
    

# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt', label="Far baseline", lw=3)
# plt.plot(bins2[0:101],histogram2, color='xkcd:strawberry', label="Close baseline", lw=3)

plt.xlabel('Residual Difference (W)')
plt.ylabel('Frequency')
plt.legend(loc='upper left')
#plt.yscale('log')
plt.show()
```

```{python}
# %matplotlib inline
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

alp = np.linspace(1, 0.1, 11)
bintest = np.linspace(-0.5,0.5,101)

for i, pair in enumerate(pairs[1:12]):
    print(i, max(intarr[i,:]), pair, RMSE_residual(intarr[i,:]))
    histogram, bins = np.histogram(intarr[i,:], bins=bintest, density=False)
    plt.plot(bins[0:100],histogram,  color=cmap(i+1), label="[1, 3] & {}".format(pair), 
             lw=3)

# histogram, bins = np.histogram(intarr[10,:], bins=bintest, density=False)
# plt.plot(bins[0:100],histogram,  color='xkcd:cobalt blue', label="[1, 3] difference to 398, 400", 
#              lw=3)

# histogramf, binsf = np.histogram(difff, bins=101, density=False)
# plt.plot(binsf[0:101],histogramf,  color='xkcd:brown', label="[1, 3] difference to 398, 400", 
#              lw=3)
# histogramARB, binsARB, = np.histogram(diffARB, bins=bintest, density=False)
plt.plot(binsARB[0:100],histogramARB,  color='xkcd:burnt orange', 
     label='ARB Baseline {}{}'.format(fipair1ARB, fipair2ARB), lw=3) 
    

# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt', label="Far baseline", lw=3)
# plt.plot(bins2[0:101],histogram2, color='xkcd:strawberry', label="Close baseline", lw=3)

plt.xlabel('Residual Difference (W)')
plt.ylabel('Frequency')
plt.legend(loc='upper left')
#plt.yscale('log')
#plt.show()
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/rhornshist2.png', dpi=300, facecolor='w')
```

```{python}
#show residual difference

r = np.linspace(0,280,11)

# %matplotlib inline
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

for i, pair in enumerate(pairs[1:12]):
    print(r[i], RMSE_residual(intarr[i,:]))
    
    plt.plot(r[i+1], RMSE_residual(intarr[i,:]), '.', color=cmap(i+1), markersize=20)
    
plt.plot(0, RMSE_residual(diffARB), 'r.', markersize=15)
plt.plot(0, RMSE_residual(diffARB2), 'g.', markersize=15)

    
plt.xlabel('Horn Pair Separation (mm)')
plt.ylabel('RMSE (W)')
plt.xticks(r)
#plt.legend(loc='upper left')
#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/rmseandr.png', dpi=300, facecolor='w')
```

```{python}
"""redo the old plots with new code???"""

p1 = [190, 192]
p2 = [211, 213]
p3 = [1, 3]
p4 = [398, 400]

pairs = [p1,p2,p3,p4]

x, y, p1i = calculate_intensity_4_baseline(p1, my150dat)


intarr = np.zeros([3, 58081])
#print(p1i.shape, intarr.shape)

#calc diffs
for i, pair in enumerate(pairs[1:4]):
    
    x, y, pi = calculate_intensity_4_baseline(pair, my150dat)
    diff = p1i/max(p1i) - pi/max(pi)
    #print(pair, diff.shape)
    intarr[i,:] = diff

#do horn plot
instFI.horn.open[:] = False

#Set3 nice too
cmap = plt.get_cmap("tab20")
cycle = plt.rcParams['axes.prop_cycle'].by_key()['color']

# %matplotlib notebook
plt.figure(figsize=(10,10))
instFI.horn.plot()
for i, pair in enumerate(pairs):
    print(pair[0], pair)
    plt.plot(centers[pair[0]-1, 0]-0.0001, centers[pair[0]-1, 1]+0.0001,
          'o', color=cmap(i), markersize=21, mfc = None)
    plt.plot(centers[pair[1]-1, 0]-0.0001, centers[pair[1]-1, 1]+0.0001,
         'o', color=cmap(i), markersize=21, alpha=1, mfc = None)

plt.xlabel('Horn Array X (m)')
plt.ylabel('Horn Array Y (m)')
plt.axis('equal')

#plt.savefig('/home/james/OneDrive/Thesisv4/Figures/figs_baselines/rhornsttttt.png')

```

```{python}
# %matplotlib inline
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rc('font', **font)
plt.figure(figsize=(16, 8))

alp = np.linspace(1, 0.1, 11)

for i, pair in enumerate(pairs[1:4]):
    print(i, max(intarr[i,:]), pair, 1)
    histogram, bins = np.histogram(intarr[i,:], bins=101, density=False)
    plt.plot(bins[0:101],histogram/max(histogram),  color=cmap(i+1), label="[190, 192] difference to {}".format(pair), 
             lw=3)

# histogram, bins = np.histogram(intarr[10,:], bins=101, density=False)
# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt blue', label="[1, 3] difference to 398, 400", 
#              lw=3)

# histogramf, binsf = np.histogram(difff, bins=101, density=False)
# plt.plot(binsf[0:101],histogramf,  color='xkcd:brown', label="[1, 3] difference to 398, 400", 
#              lw=3)
    
    

# plt.plot(bins[0:101],histogram,  color='xkcd:cobalt', label="Far baseline", lw=3)
# plt.plot(bins2[0:101],histogram2, color='xkcd:strawberry', label="Close baseline", lw=3)

plt.xlabel('Residual Difference (W)')
plt.ylabel('Frequency')
plt.legend(loc='upper left')
#plt.yscale('log')
plt.show()
```

```{python}
"""nice TD plot?"""
td = qubic.qubicdict.qubicDict()
td.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
td['config'] = 'TD'
tdq = qubic.QubicInstrument(d)

centers = tdq.horn.center[:, 0:2]
col = tdq.horn.column
row = tdq.horn.row

#instFI = qubic.QubicInstrument(d)
#hornsFI = instFI.horn.open

#hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instTD = qubic.QubicInstrument(td)
#instTD.horn.open[~hornsTD] = False

#instTD.horn.open
plt.figure()
instTD.horn.plot()
```

```{python}
cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
instTD.horn.plot()
for i in range(len(centers)):
    if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1]-0.004, 'FI {0:}'.format(str(i+1)), color='g',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1], 'TD {0:}'.format(str(cnt)), color='r',fontsize=8)
        plt.text(centers[i,0]-0.005, centers[i,1]-0.0015, 'TD {0:}'.format(str(cnt)), color='r',fontsize=12)
        
        TDhornsFIconf[i] = cnt
        
        cnt+=1
plt.axis('equal')
```

```{python}
"""nice FI plot?"""
fi = qubic.qubicdict.qubicDict()
fi.read_from_file('/home/james/libraries/qubic/qubic/dicts/pipeline_demo.dict')
fi['config'] = 'FI'
fiq = qubic.QubicInstrument(fi)

centers = fiq.horn.center[:, 0:2]
col = fiq.horn.column
row = fiq.horn.row

#instFI = qubic.QubicInstrument(d)
#hornsFI = instFI.horn.open

#hornsTD = (col >= 8) & (col <= 15) & (row >= 8) & (row <= 15)
#print(hornsTD)

### Now create First Instrument and TD monochromatic
instFI = qubic.QubicInstrument(fi)
#instTD.horn.open[~hornsTD] = False

#instTD.horn.open
plt.figure()
instFI.horn.plot()
```

```{python}
cnt = 1
TDhornsFIconf = np.zeros(400)

# %matplotlib notebook
plt.figure(figsize=(10,10))
instFI.horn.plot()
for i in range(len(centers)):
    #if hornsTD[i] == True:
        #plt.text(centers[i,0]-0.006, centers[i,1], 'c{0:}'.format(col[i]), color='r',fontsize=8)
        #plt.text(centers[i,0]+0.00001, centers[i,1], 'r{0:}'.format(row[i]), color='b',fontsize=8)
    plt.text(centers[i,0]-0.006, centers[i,1]-0.0021, '{0:}'.format(str(i+1)), color='g',fontsize=10)
        #plt.text(centers[i,0]-0.005, centers[i,1], 'TD {0:}'.format(str(cnt)), color='r',fontsize=8)
        #plt.text(centers[i,0]-0.005, centers[i,1]-0.0015, 'TD {0:}'.format(str(cnt)), color='r',fontsize=12)
        
    TDhornsFIconf[i] = cnt
        
    cnt+=1
plt.axis('equal')
```

```{python}
font = {'family' : 'normal',
        'weight' : 'normal',
        'size'   : 20}
plt.rcParams.update({
    "axes.facecolor":    'xkcd:pale turquoise',  # green with alpha = 50%
})
plt.rc('font', **font)
# %matplotlib notebook
plt.figure(figsize=(14,14), facecolor='white')
instFI.detector.plot(edgecolor='xkcd:faded red',
    facecolor='xkcd:faded red',
    fill=True)
plt.xlabel('FPRF x (m)')
plt.ylabel('FPRF y (m)')
plt.tight_layout()
```

```{python}
print(instFI.detector)
```

```{python}

```
